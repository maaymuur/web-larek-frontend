# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```
## Данные и типы, используемые в приложении

Карточка товара

```
export interface ICard{
    id:string;
    description:string;
    image:string;
    title:string;
    category:string;
    price:number;
}


Пользователь

```
export interface IUser{
    payment:string;
    email:string;
    phone:number;
    address:string;
}

```
Интерфейс хранения массива карточек товаров

```

export interface ICardsData{
    cards:ICard[];
    preview:string | null;
}


Данные карточки, используемые просто в карточках товаров на главной странице

```
export type TCardInfo = Pick<ICard,  "image" | "title" | "category" | "price">
 
Данные карточки, используемые в модальном окне детального изучения карточки 

export type TCardModalInfo = Pick<ICard, "description" | "image" | "title" | "category" | "price">

Данные карточки, используемые в модальном окне корзины

export type TCartModal = Pick<ICart, "total" | "items">

Данные пользователя, используемые в модальном окне заполнения иформации покупки: адрес и оплата

export type TUserModalPaymentAddress = Pick<IUser, "payment"|"address">

Данные пользователя, используемые в модальном окне заполнения иформации покупки: имэил и номер телефона

export type TUserModalEmailPhone = Pick<IUser, "email"|"phone">

```

 ## Архитерктура приложения  

 Код приложения разделен на слои согласно парадигме MVP:
 - слой представления, отвечает за отображение данных на странице
 -слой данных, отвечает за хранение и изменение данных
 -презентер, отвечает за связь представления и данных

  ### Базовый код

#### Класс API

Содержит в себе базовую логику отправки запросов. В конструктор передает базовый адрес сервера и опциональный объект с заголовками запросов.

- 'get' - выполняет GET запрос на переданный в параметрах ендпоинт и возвращает промис с объектом, которым ответил сервер.

- 'post' - принимает объект с данными, которые будут переданы в JSON в теле запроса, и отправляет эти данные на ендпоинт переданный как параметр при вызове метода. По умолчанию выполняется 'POST' запрос, но метод запроса может быть переопределен заданием третьего параметра при вызове.

#### Класс EventEmmiter

Брокер событий позволяет отправлять события и подписываться на события, происходящие в системе. Класс используется в презентере для обработки событий и в слоях приложения для генерации событий.

Основные методы, реализуемые классом описаны интерфейсом  `IEvents`
-`on` - подписка на событие 
-`emit` - инициализация события
-`trigger` - возвращает функцию, при вызове которой инициализируется требуемое в параметрах событие

### Слой данных

#### Класс CardsData
Класс отвечает за хранение и логику работы с данными карточек созданных пользователями.\
Конструктор класса принимает инстант брокера событий\
В полях класса хранятся следующие данные:
- _cards: ICard[] - массив объектов карточек
- _preview: string | null - id карточки, выбранной для просмотра в модальной окне
- events: IEvents - экземпляр класса `EventEmitter` для инициации событий при изменении данных.

Так же класс предоставляет набор методов для взаимодействия с этими данными.
- getCard(cardId: string): ICard - возвращает карточку по ее id
- а так-же сеттеры и геттеры для сохранения и получения данных из полей класса

#### Класс UserData
Класс отвечает за хранение и логику работы с данными текущего пользователя.\
Конструктор класса принимает инстант брокера событий\
В полях класса хранятся следующие данные:
- name: string - Имя пользователя
- about: string - Информация о пользователе
- avatar: string - ссылка на аватар
- _id: string - уникальный идентификатор
- cohort: string - номер когорты
- events: IEvents - экземпляр класса `EventEmitter` для инициации событий при изменении данных.

Так же класс предоставляет набор методов для взаимодействия с этими данными.
- getUserInfo(): TUserPublicInfo - возвращает основные данные пользователя отображаемые на сайте
- setUserInfo(userData: IUser): void - сохраняет данные пользователя в классе
- checkValidation(data: Record<keyof TUserPublicInfo, string>): boolean - проверяет объект с данными пользователя на валидность

#### Класс CartsData

Класс отвечает за хранение и логикгу работы корзины с товарами

Конструктор класса принимает инстант брокера событий\
В полях класса хранятся следующие данные:
-total:ICard['price'];  - свойство с массивом цен товаров для будущего подсчета итоговой суммы
-items:ICard['id']; - свойство с массивом айди товаров для того, что бы они могли отображаться в корзине

Так же класс предоставляет набор методов для взаимодействия с этими данными и даннами интерфейса ICard.

-addCard(card:ICard):void; - добавляет карточку в корзину
-deleteCard(cardId:string, playload:null):void; - удаляет карточку из корзины

## Классы представления

Все классы представления отвечают за отображение внутри контейнера (Dom-элемент) передаваемых в них данных.

  #### Класс Modal

  Реализует модальное окно. Так же предоставляет методы `open`, `close` для управления отображением модального окна. Устанавливает слушатель для закрытия п
  модального окна по клику на оверлей и кноку-крестик для закрытия попапа.

  -constructor(selector:string, events: IEvents). Конструктор принимает селектор, по которому в разметке страницы будет идентифицировано модальное окно и экземпляр класса `EventEmitter` для возможности инициации событий.


  Поля класса:

  - submitButton:HTMLButtonElement - кнопка подтверждения
  -   _form: HTMLFormElement - элемент формы
  - modal: HTMLElement - элемент модального окна
  - events:IEvents - брокер событий
  - formName:string - значение атрибута name формы
  - inputs:NodeListOf<HTMLInputElement> - коллекция всех полей ввода формы
  - errors:Record<string, HTMLElement> - объект, хранящий все элементы для вывода ошибок под полями формы с привязкой к атрибуту name инпутов
  -imageElement:HTMLImageElemet - элемент разметки с изображением
  -imageTitle: HTMLElement - элемент разметки для вывода названия краточки
  -imageDescr: HTMLElement - элемент разметки для вывода описания карточки
  -imagePrice: HTMLElement - элемент разметки для вывода цены товара карточки
  -imageCategory: HTMLElement - элемент разметки для вывода категории товара карточки

Методы:

- setValid(isValid:boolean):void - изменяет активность кнопки подтверждения
- getInputValues():Record<string, string> - возвращает объект с данными из полей формы, где ключ - name инпута, значение - данные введенные пользователем
- setError(data:{field:string, value:string, validInformation:string}):void - принимает объект с данными для отображения или сокрытия текстов ошибок под полями ввода
- showInputError(field:string, errorMessage:string):void - отображает полученный текст ошибки под указанными полем ввода
- hideInputError(field:string): void - очищает текст ошибки под указанным полем ввода
- close(): void - расширяет родительский метод дополнительно при закрытии очищая поля формы и деактивируя кнопку сохранения
- open(data:{title:string, image:string, price:number, description:string, category:string}):void - метод, принимающий данные краточки, которые используются для заполнения атрибутов элементов модального окна
-  get form: HTMLElement - геттер для получения элемента формы

#### Класс Card

Класс используется для отображения карточек на странице сайта. В конструктор класса передается DOM элемент. В классе устанавливаются слушатели на все интерактивные элементы, в результате взаимодействия с которыми пользователя генерируются соответствующие события.

Методы: setData(cardData:ICard, cardID:string):void - заполняет атрибуты элементов карточки данными.
-геттер id возвращает уникальный id карточки

#### Класс CardsContainer

Отвечает за отображение блока с карточками товаров на главной странице. В конструктор принимает контейнер, в котором размещаются карточки

 ### Слой коммуникации

 #### Класс AppApi

 Принимает в конструктор экземпляр класса API и предоставляет методы, реализующие взаимодействие с бэкендом сервиса.

 ## Взаимодействие компонентов

 Код, описывающий взаимодействие представления и данных между собой находится в файле `index.ts`, выполняющем роль презентера. \ 

 Взаимодействие осуществляется за счет событий генерируемых с поомщью брокера событий и обработчиков этих событий, описанных в `index.ts`\

 В  `index.ts` сначала создаются экземпляры всех необходимых классов,  а затем настраивается обработка событий.

 *Список всех событий, которые могут генерировать в системе:*\
 *События изменения данных (генерируются классами моделями данных)*

 - `user:changed` - изменение данных пользователя 
 - `cards:selected` - изменение открываемой в модальном окне картинки карточки

 *События, возникающие при взаимодействии пользователя с интерфейсом (генерируются классами, отвечающими за представление)*

 - `card:select`- выбор карточки для отображения в модальном окне
 - `card:delete` - выбор карточки для удаления
 - `order:input` - изменение данных способа оплаты и адрес
 - `order:validation` - событие, сообщающее о необходимости валидации формы способа оплаты и адрес
  - `contacts:input` - изменение данных имэила и номера
 - `contacts:validation` - событие, сообщающее о необходимости валидации формы имэила и номера
  - `contacts:submit` - событие, генерируемое при прохождении формы оплаты с адресом и способом доставки
 - `order:submit` - событие, генерируемое при прохождении формы оплаты с номеро и имэилои
 - `cart:open` - открытие модального окна корзины
 - `card:previewClear` - необходима очистка данных выбранной для показа в модальном окне карточки
