# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/styles/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```
## Сборка

```
npm run build
```

или

```
yarn build
```

## Данные и типы данных, используемые в приложении 

### Типы 
- `ApiListResponse<Type>` : тип данных ответа сервера , колличество элементов и массив элементов.
- `ApiPostMethods` : описывает методы обращения к серверу.
- `FormErrors` : опиывает ошибки формы в виде пар "ключ: значение", ключ - поле формы, значение - строка с текстом ошибки.
- `PaymentType` : описывает варианты формы оплаты : наличными и онлайн.
- `OrderForm` : тип описывающий поля Форм для создания  заказа.
- `ProductId` : тип описывающий данные для отображения товара.

### Интерфейсы

- `IProduct` : данные о товаре.
- `IEvents`: методы работы с событиями.
- `IPaymentForm` : форма с данными о доставке и типом оплаты.
- `IContactsForm:` форма с данными о контактах: телефон, почта.
- `IOrder`: заказ.
- `IBasket`: корзина товаров.
- `IFormStatus` - состояние формы.
- `IOrderResult` - результат заказа.
- `IComplete` - заказ выполнен.
- `IActions` - действие при клике.
- `IModal` - интерфейс для модального окна.
- `IApiLarek` - интерфейс описывающий методы для работы с API магазина.
- `IPage` - интерфейс страницы:  каталог , счётчик и блокировка.

#### объект настройки категорий товара 
- `categorySettings` - объект, хранящий данные в парах ключ-значение ,где ключ - название категори, а значение - соответствующий селектор.

## Архитектура приложения
- Код приложения разделён на слои согласно архитектурному шаблону MVP.
- Cлой Model - управляет данными приложения, осуществляет бизнес-логику и хранение данных.
- Слой View - отвечает за отображение данных на устройстве пользователя.
- Слой Presenter - слой отвечающий за связь между View и Presenter , получает данные из Model и передает их в View для отображения. Для связи между слоями будет использоваться брокер событий.


## Базовый Код

### Класс Api

Класс описывающий базовую логику для отправки запросов на сервер. 

`constructor(baseUrl: string, options: RequestInit = {})` - конструктор принимает базовый URL - строчного типа и  глобальные опции для всех запросов ;

Методы класса:

- `get` - выполняет GET запрос на указанный эндпоинт и возвращает промис с ответом сервера
- `post` - отправляет данные в формате JSON на указанный эндпоинт методом POST. Метод запроса можно переопределить, указав третий параметр при вызове метода
- `handleResponse(response: Response)` - обработчик ответа сервера, принимает ответ сервера и возвращает промис с данными в случае успеха, 

### Класс EventEmitter
Брокер событий - позволяет отправлять и подписываться на события, происходящие в системе. Класс используется в презентере для обработки событий и в слоях приложения для генерации событий.

Основные методы , реализуемые классом описаны интерфейсом `IEvents`:
- `on` - установить обработчик на событие
- `emit` - инициализация события c возможностью передачи данных
- `trigger` - возвращает функцию, при вызове которой инициализируется требуемое в параметрах событие.

Так же описаны методы : 
- `onAll` - подписаться на все события
- `ofAll` - сбросить все обработчики
- `off` - снять обработчик с события

### Класс Сomponent
Абстрактный класс для отображения пользовательского интерфейса. Он содержит обобщённый тип Т - тип данных, которые будут использоваться в компоненте.
- `constructor(element: HTMLElement)` - в конструкторе принимает элемент разметки : HTMLELement , который является основным родительским контейнером компонента.
 

- Методы класса : 

- `toggleClass` - переключатель класса переданного элемента.
- `setText` - устанавливает текст
- `setImage` - устанавливает изображение
- `render` - возвращает корневой DOM-элемент с заполненными данными

### Класс View
Наследует Класс Component и представляет собой компонент пользовательского интерфейса с возможностью обработкий событий и добавляет возможность работы с событиями.

`constructor(protected events: EventEmitter, container: HTMLElement)` - в констукторе принимает брокер событий - объект объект EventEmitter, контэйнер - элемент разметки HTMLElement;

## Слой Model 

### Класс App
Класс обеспечивающий работу с данными в приложении.

- `constructor(protected events: EventEmitter)` - в конструкторе принимает экземпляр  EventEmitter(брокер событий), с помощью которого будут генерирововаться соответствующие события происходящие с данными.

Свойства:

- `products` - данные всех товаров
- `basket` - данные корзины пользователя
- `order` - данные для заказа
- `errors` - ошибки валидации формы

Методы : 

- `setProductList` - метод для инициализации всего списка товаров, полученных с сервера
- `productWindow` - устанавливает текущий товар для предпросмотра
- `ifInBasket` - проверяет, есть ли товар в корзине
- `addToBasket` - добавляет товар в корзину
- `removeSomethingFromBasket` - удаляет товар из корзины.
- `removeEverythingFromBasket` - очищает корзину
- `orderForm` - устанавливает поле заказа
- `validation` - Проверяет корректность данных формы заказа

### Класс larekApi
Наследует класс Api, предназначен для взаимодействия с API интернет-магазина, включая получение списка продуктов, данных конкретного продукта и отправку заказов.

- `constructor (cdn: string, baseUrl: string, options?: RequestInit)` - в конструкторе принимает cdn - адрес изображения,   принимает базовый URL и глобальные опции для всех запросов (опционально).

Свойства:

- `cdn` - только для чтения 

Методы: 

- `getListItems` - получает список товаров, возвращает массив объектов . Каждый товар включает обновленный путь изображения через CDN.
- `getItem` - получает информацию о конкретном продукте по его ID и возвращет объект с информацией о продукте
- `orderItems` - отправляет заказ на сервер

## Слой View

### Класс Page
Класс для реализации главной страницы приложения: каталог товаров, счётчик корзны, отображение модального окна. Наследует класс View и будет использовать данные описанные интерфейсом IPage. 

- `constructor(events: EventEmitter , container: HTMLElement)` -
  конструктор принимает экземпляр класса брокер событий и контейнер - элемент разметки в котором будут размещаться основные компоненты.

Свойства :

- `count` - счётчик товаров корзины
- `catal` - отображение каталога товаров
- `wrap` - элемент обёртки страницы
- `basket` - кнопка открытия модального окна с корзиной

Методы : 

- `set counter` - устанавливает значение счётчика 
- `set catalog` - наполняет содержимое каталога полученными данными
- `set block` - блокирует прокрутку страницы при открытии модального окна

### Класс Modal 
Класс для реализации модальных окон. Наследует класс Сomponent.

`constructor(container: HTMLElement, protected events: IEvents)`-  конструктор принимает контейнер - элемент разметки HTMLElemnt, и  экземпляр объекта описанный интерфейсом IEvents.

Свойства : 
- `_сloseBtn` - кнопка для закрытия модального окна
- `_content` - контент отображаемый внутри модального окна

Методы:
- `set content` - заполнение контента модального окна
- `open` - открытие модального окна
- `close` - закрытие модального окна
- `Escape`- обработчик закрытия по клавише `Escape`
- `render` - отображение модального окна.

### Класс Basket
Класс для отображения корзины и отображения списка выбранных товаров, а так же добавление и удаление этих товаров. Наследует класс View. 

- `constructor(container: HTMLElement, events: EventEmitter)` -
  конструктор принимает контейнер - элемент разметки и экземпляр класса брокера событий.

Свойства :

- `list` - список товаров
- `total` - общая стимость
- `btn` - кнопка для дальнейшего оформления покупки

Методы:

- `set items` - устанавливает список товаров в корзине 
- `set total` - устанавливает общую  стоимость всех товаров

### Класс Success
Класс для отображения сообщения об успешной покупке и отображение общей суммы операции, наследует класс Сomponent.

- `constructor(container: HTMLElement, events: EventEmitter)` -
  конструктор принимает контейнер - элемент разметки и экземпляр класса брокера событий.


Свойства : 
- `total` - элемент для отображения общей суммы операции
- `evt`- событие при клике на кнопку после завершения заказа
- `close`- кнопка для закрытия модального окна.

Методы:
- `set summ` - установка суммы списания

### Класс Form
Класс для создания форм с различным контентом, наследует класс Component. Устанавливает обработчики на все формы , и обрабатывает ввод данных , показывает сообщения об ошибках .

- `constructor(container: HTMLElement, events: EventEmitter)` -
  конструктор принимает контейнер - элемент разметки и экземпляр класса брокера событий.

Свойства :

- `_btn` - элемент кнопки для отправки формы

- `_err` - элемент отображения ошибок формы

Методы :

- `onInputChange` :  обработка событий ввода , и оповещение всех слушателей об изменении
- `set valid` : изменяет состояние кнопки отправки
- `set errors` : отображает ошибки валидации формы
- `render` : отображение формы

### Класс OrderProduct
Класс для отображения формы доставки, наследует класс Form.
- `constructor(container: HTMLElement, events: EventEmitter)` -
  в конструкторе принимает контейнер - элемент разметки и экземпляр класса - брокер событий.

Свойства : 

- `card` - кнопка онлайн оплаты
- `cash` - кнопка оплаты наличными 

Методы:

- `set address` - устанавливает адре доставки
- `set payment` - переключение активности кнопок оплаты
- `set phone` - устанавливает контактный телефон
- `set email` - устанавливает адрес электронной почты

### Класс ProductView 
Класс для реализации отображения карточки товара и настройки его элементов.
Наследует класс Component работает с типом ProductId

- `constructor(container: HTMLElement, actions?:IActions)` - в конструктор класса передается элемент разметки, что позволяет при необходимости формировать карточки разных вариантов верстки и экземпляр EventEmitter для инициации событий.

Свойства :
- `tit` - элемент отображения название товара
- `priceOfItem` - элемент отображения цены товара
- `img` - изображение товара
- `btn` - элемент для добавления товара в корзину
- `descr` -  элемент отображения описания товара
- `categor` - элемент отображения категории товара
- `ind` - элемент для установки индекса товара

Методы :

- `set title` - установка названия товара
- `get title` - получение названия товара
- `set index` - установка индекса товара
- `get index` - получение индекса товара
- `set price`/`get price` - установка/получение цены товара
- `set image` - установка изображения товара 
- `set description`- установка описания товара
- `set/get category` - установка/получение категории товара
- `set/get id` - установка/получение идентификатора товара
- `set buttonTitle` - установка текста на  элемент кнопки

## Слой Presenter

События:

- `modal:open` - открытие модального окна
- `modal:close` - закрывает модальное окно
- `order:result` - подтверждение успешной покупки
- `order:open` - отображает окно успешной оплаты 
- `order:change`- изменение данных заказа , обновление поля в приложении
- `order:submit`- подтверждения адреса и формы оплаты заказа
- `contacts:submit`- подтверждение контактных данных заказа
- `formErrors:change` - отображение ошибок инпутов
- `preview:change` - изменение модального окна карточки

